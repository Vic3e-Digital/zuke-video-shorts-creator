# GPU-enabled base image
FROM nvidia/cuda:11.8-cudnn8-runtime-ubuntu22.04

# Install Python and dependencies
RUN apt-get update && apt-get install -y \
    python3.10 python3-pip ffmpeg \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY requirements-gpu.txt .

# Install PyTorch with CUDA
RUN pip3 install torch torchaudio --index-url https://download.pytorch.org/whl/cu118
RUN pip3 install -r requirements-gpu.txt

COPY . .
EXPOSE 8000
CMD ["python3", "azure_api.py"]